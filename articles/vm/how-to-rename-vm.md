---
title: Azureで仮想マシン名を変更する
date: 2022-9-29 9:30:00
tags:
  - VM
  - HowTo
---

> [!WARNING]
> 当手順について新規に記事が作成されましたので、今後はこちらをご参照いただけますと幸いです。
>  
> ■ご参考：設定変更不可の項目を VM 再作成により再設定する手順  
> [https://jpaztech.github.io/blog/vm/recreate-vm-to-change-settings/](https://jpaztech.github.io/blog/vm/recreate-vm-to-change-settings/)

こんにちは。Azure テクニカル サポート チーム、インターン生の杉野です。

お客様より、リソース管理の都合上、既存の仮想マシンのリソース名を変更したいというお問い合わせをいただくことがあります。

ゲスト OS 内のホスト名は、ゲスト OS 内よりすぐに変更いただくことが可能です。
しかしながら、Azure のリソース名である仮想マシン名は Azure Portal 等より変更することは叶わず、変更実施する場合には仮想マシンの再作成が必要となります。
そこで今回は、仮想マシン名を変更する方法およびその注意点についてご紹介いたします。

<!-- more -->

## 目次

1. 仮想マシン名とは
2. 変更手順
3. [おまけ] 仮想マシン名の代わりにタグでも管理できる

---

## 1. 仮想マシン名とは

今回変更する "仮想マシン名" とは、Azure のリソースとして表示される名前を指しています。
Azure Portal にて仮想マシンを選択し、左メニュー [概要] を選択した画面に表示される "コンピューター名" や、ゲスト OS 内で表示される "コンピューター名"、"ホスト名" とは異なりますのでご注意ください。
ただし、Azure Marketplace や一般化されたイメージより、新規に仮想マシンを作成した場合には、仮想マシン名と同名にて "コンピューター名" や "ホスト名" が設定されます。

![](./how-to-rename-vm/01.png)

ゲスト OS 内の "コンピューター名" や "ホスト名" は、管理のためにシステム名などに基づき命名されることが多いかと思います。
当該環境の用途が変更となった場合には、管理の観点から新しいシステムに応じて名前を変える必要がありますが、それにより、ゲスト OS 内の名前と Azure リソースとしての仮想マシン名が異なってしまった場合にも管理が複雑となってしまうことが想定されます。

---

## 2. 変更手順

冒頭に記載した通り、Azure のリソース名を簡単に変える方法はなく、今回の場合は仮想マシンの再作成が必要となります。
再作成手順の概要は以下の通りとなります。

- 事前準備: 引き継ぎたい情報を確認する
- 手順 1: 仮想マシンを削除する
- 手順 2: 仮想マシンを新しい名前で作成する

### 事前準備: 引き継ぎたい情報を確認する

再作成時には、元の仮想マシンと同様の設定を実施する必要があるかと思いますので、事前に構成を控えておくことをお勧めします。
下記に項目の例を紹介しますが、その他必要な設定および構成がある場合は、適宜控えておきましょう。

#### 仮想マシン - 左メニュー [概要]

[必須項目]

- リソース グループ名
- 場所 (リージョン)
- 仮想マシンのサイズ
- パブリック IP アドレス (利用している場合)
  ※ IP アドレスが表示されている場合にはクリックし、リソース名を確認します。
- 仮想ネットワーク / サブネット名

![](./how-to-rename-vm/05.png)

[設定がある場合]
- 可用性とスケーリング (可用性セットまたは可用性ゾーン)

![](./how-to-rename-vm/06.png)

#### 仮想マシン - 左メニュー [ネットワーク]

> [!WARNING]
> 既存の VNET/ Subnet、NIC をご利用いただく場合、既存の NSG 等との紐づけが実施されたままとなりますので、再設定は不要となります。

[元の NIC を使う場合]

- ネットワーク インターフェイス名 (複数の場合はすべて) を控えます。

> [!NOTE] 
> **NIC は引き継げる ?**
> Azure PowerShell や Azure CLI を用いて仮想マシンを作成する場合には既存の NIC を指定することが可能ですが、Azure Portal から仮想マシンを作成いただく場合には指定することは現状叶いません。
> Azure Portal から操作を行いたい場合には、仮想マシン作成後に NIC の付け替えを実施いただく必要があります。

[元の NIC を使わない場合]
NSG や負荷分散等の設定は必要に応じて控えておきましょう。

![](./how-to-rename-vm/20.png)

#### 仮想マシン - 左メニュー [ディスク]

- OS ディスク名とデータ ディスク名 (複数の場合はすべて) を控えます。
- 全ディスクのホスト キャッシュ設定も忘れずに控えておきましょう。

![](./how-to-rename-vm/08.png)

#### その他

上記以外にも仮想マシンの再作成時に設定可能な項目は複数あります。必要な項目は控えておきましょう。

- Azure ハイブリッド特典の設定
- 近接配置グループ名
- Azure Dedicated Host の使用の有無
- 容量予約の使用の有無
- 拡張機能名 (複数の場合はすべて)
- VM アプリケーション (複数の場合はすべて)
- 自動シャットダウンの設定
- バックアップの設定
- ゲスト OS の更新プログラム
- ゲスト OS 診断の設定
- ブート診断の設定
など

### 手順 1: 仮想マシンを削除する

> [!WARNING]
> **誤操作に備えて**
> 予期せぬご状況に備えるためにも、操作前には Azure Backup やディスクのスナップショット (要 OS シャットダウン) をご取得いただくことをお勧めします。
> 　
> ご参考) Azure VM バックアップについて
> [https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction](https://learn.microsoft.com/ja-jp/azure/backup/backup-azure-vms-introduction)
> 　
> ご参考) 仮想ハード ディスクの Azure スナップショットを作成する
> [https://learn.microsoft.com/ja-jp/azure/virtual-machines/snapshot-copy-managed-disk?tabs=portal](https://learn.microsoft.com/ja-jp/azure/virtual-machines/snapshot-copy-managed-disk?tabs=portal)

以下の画面の通り、仮想マシンの [削除] をクリックします。

![](./how-to-rename-vm/03.png)

[削除] をクリックした後に表示される確認画面にて、"強制削除の適用" や 各関連リソースの "VM で削除" のボックスにチェックが入っていないことを確認します。
問題がない場合には、削除について理解した文言にチェックを入れ、[削除] をクリックします。

![](./how-to-rename-vm/02.png)

### 手順 2: 仮想マシンを新しい名前で作成する

削除した仮想マシンで使用していた OS ディスクより、控えた内容をもとに仮想マシンを作成します。

今回は、Azure Portal を使用して仮想マシンを作成し、その後、元の NIC を使用するために NIC の付け替えを実施する手順をご紹介します。

> [!WARNING]
> 今回の Azure Portal で仮想マシンを作成する手順の場合、新たな NIC が仮想マシンに接続されるため、MAC アドレスが変更されます。
> Linux 仮想マシンの場合、設定ファイル内に MAC アドレスが含まれる可能性がありますので、ご注意いただけますと幸いです。
> 　
> ご参考) ネットワーク インターフェイスの作成、変更、削除
> [https://learn.microsoft.com/ja-jp/azure/virtual-network/virtual-network-network-interface?tabs=network-interface-portal](https://learn.microsoft.com/ja-jp/azure/virtual-network/virtual-network-network-interface?tabs=network-interface-portal)
> 抜粋：注意
>> Azure では、ネットワーク インターフェイスの仮想マシンへのアタッチと、仮想マシンの初回起動の後にのみ、ネットワーク インターフェイスに MAC アドレスが割り当てられます。
>> Azure によってネットワーク インターフェイスに割り当てられる MAC アドレスは指定できません。
>> MAC アドレスがネットワーク インターフェイスに割り当てられると、そのネットワーク インターフェイスが削除されるか、プライマリ ネットワーク インターフェイスのプライマリ IP 構成に割り当てられたプライベート IP アドレスが変更されるまで、その状態は変わりません。
>> IP アドレスと IP 構成の詳細については、IP アドレスの管理に関するページをご覧ください。

#### 仮想マシンの作成

1. 削除した仮想マシンで使用していた OS ディスク (控えていた OS ディスク名を参照) を選択します。
   ![](./how-to-rename-vm/09.png)

2. OS ディスクの [概要] から [VM の作成] を選択します。
   ![](./how-to-rename-vm/10.png)

3. 先ほど控えた内容をもとに、仮想マシンを作成します。
   以下に例を示しますが、各項目はご自身の環境に合わせて設定してください。
   - **[基本] タブ**：
     ![](./how-to-rename-vm/19.png)

     > [!WARNING]
     > 可用性オプション (可用性セットまたは可用性ゾーン) につきましては、仮想マシン作成時にのみ設定できる項目になりますので、ご利用いただく場合には忘れずにご設定ください。
     > 　
     > 可用性ゾーンをご指定いただく場合、ディスクで指定いただいているゾーンと同じゾーンを指定する必要がありますのでご注意ください。

   - **[ディスク] タブ**：
     既存のデータ ディスクを接続する場合は、 [ディスク] タブで [既存のディスクの接続] を選択します。
     データ ディスクのホストのキャッシュ設定も控えたパラメータに設定します。
     ![](./how-to-rename-vm/12.png)
  
   - **[ネットワーク] タブ**：
     既存のネットワーク インターフェースの接続は仮想マシン作成後に行います。そのため、この段階での "NIC ネットワーク セキュリティ グループ" の設定は不要です。
     ※ 既存の VNET/ Subnet、NIC をご利用いただく場合、既存の NSG との紐づけが実施されたままとなりますので、仮想マシン作成時に新たに NSG を設定いただく必要はございません。
     ![](./how-to-rename-vm/13.png)

   - 全ての設定が完了後、 [確認および作成] から[作成] をクリックします。
     ![](./how-to-rename-vm/14.png)

4. 作成が完了すると新しく作成した仮想マシンを確認することができます。
   ![](./how-to-rename-vm/15.png)

#### NIC の付け替え

1. 仮想マシン作成後、既存 NIC を接続するため、仮想マシンを停止 (割り当て解除) します。
   ![](./how-to-rename-vm/16.png)

2. 仮想マシン停止 (割り当て解除) 後、仮想マシンのページから [ネットワーク] - [ネットワーク インターフェイスの接続] を選択し、削除した仮想マシンで使用していた NIC を接続します。
   ![](./how-to-rename-vm/17.png)

3. 既存の NIC の接続完了後も、仮想マシン作成時に作成された NIC がまだプライマリとなっているの状態なので、[ネットワーク インターフェイスのデタッチ] を選択し、分離する必要があります。
   ![](./how-to-rename-vm/18.png)

   NIC のデタッチを実施後、セカンダリとして接続した既存 NIC は自動的にプライマリとなります。
   なお、デタッチした NIC については削除されても問題ありません。

4. 仮想マシンを起動します。

---

## 3. [おまけ] 仮想マシン名の代わりにタグでも管理できる

ここまでの内容の通り、Azure のリソースとしての仮想マシン名を変えるためには再作成が必要となり、構成の確認や再設定等、それなりの時間がかかることがお分かりいただけたかと思います。

そのため、仮想マシン名にすぐに変更されうる情報 (プロジェクト名や担当者名など) を使うと、後々に運用変更が発生した際に、異なる名前による管理の負荷や変更作業の負荷がかかる可能性があります。

それでは、どのように管理するのがよいのか。
Azure では、リソース管理に用いるタグという機能が用意されています。

> ご参考) リソースの名前付けとタグ付けの意思決定ガイド
> [https://learn.microsoft.com/ja-jp/azure/cloud-adoption-framework/decision-guides/resource-tagging/?toc=%2Fazure%2Fazure-resource-manager%2Fmanagement%2Ftoc.json](https://learn.microsoft.com/ja-jp/azure/cloud-adoption-framework/decision-guides/resource-tagging/?toc=%2Fazure%2Fazure-resource-manager%2Fmanagement%2Ftoc.json)

> ご参考) タグを使用して Azure リソースと整理階層を整理する
> [https://docs.microsoft.com/ja-jp/azure/azure-resource-manager/resource-group-using-tags](https://docs.microsoft.com/ja-jp/azure/azure-resource-manager/resource-group-using-tags)

![](./how-to-rename-vm/04.png)

変更されうる細かな情報をタグに記載しておけば、後からの変更も簡単にできます。
仮想マシンに付与するタグを変更する場合、仮想マシンの停止は不要であり、変更処理自体もお時間を要さないことが想定されています。(弊社環境での検証時には、数十秒程度で完了しました。)
リソースの管理手段として、ご参考となれば幸いです。
